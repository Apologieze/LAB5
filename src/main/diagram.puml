@startuml
' Define main packages for MVC structure
package "Modèle" {
    ' Classes in the model
    class Image {
        - data : byte[]
        + getData() : byte[]
    }

    class Perspective {
        - scale : double
        - position : Point
        + getScale() : double
        + getPosition() : Point
        + setScale(scale : double) : void
        + setPosition(position : Point) : void
        + save(filePath : String) : void
    }

    ' Observer pattern for model update notification
    interface Subject {
        + attach(Observer) : void
        + detach(Observer) : void
        + notifyObservers() : void
    }

    ' Image and Perspective are separate subjects in Observer pattern
    Image --> Subject
    Perspective --> Subject
}

package "Services" {
    ' Service for saving perspectives to a file
    class SaveService {
        + savePerspective(perspective : Perspective, filePath : String) : void
    }
}

package "Vue" {
    ' Classes in the view
    interface Observer {
        + update() : void
    }

    class ThumbnailView {
        + update() : void
    }

    class PerspectiveView {
        + update() : void
    }

    ThumbnailView --> Observer
    PerspectiveView --> Observer
}

package "Contrôleur" {
    ' Command pattern for undoable operations
    interface Command {
        + execute() : void
        + undo() : void
    }

    ' Specific commands for zoom and translation
    class ZoomCommand {
        + execute() : void
        + undo() : void
    }

    class TranslateCommand {
        + execute() : void
        + undo() : void
    }

    Command <|-- ZoomCommand
    Command <|-- TranslateCommand

    ' Command for saving a perspective
    class SaveCommand {
        + execute() : void
        + undo() : void
    }

    Command <|-- SaveCommand

    ' Singleton pattern for command history management
    class CommandManager {
        - commands : List<Command>
        + addCommand(command : Command) : void
        + undo() : void
        {static} - instance : CommandManager
        {static} + getInstance() : CommandManager
    }

    ' Mediator pattern (optional) for interaction between controls
    interface Mediator {
        + notify(sender, event) : void
    }

    class PerspectiveController {
        + handleZoom(scale : double) : void
        + handleTranslate(x : int, y : int) : void
        + handleSave(filePath : String) : void
    }

    PerspectiveController --> Mediator
    CommandManager --> Command
    CommandManager --|> Singleton
}

' Relationships between model, view, and controller
Perspective --> Command : <<uses>>
ThumbnailView --> Image
PerspectiveView --> Perspective
PerspectiveController --> Perspective
SaveService --> Perspective
SaveCommand --> SaveService
@enduml
